# @package _global_

# to execute this experiment run:
# python train.py experiment=example

defaults:
#  - override /hydra/launcher: slurm_spiro
  - override /paths: qdtis056z
  - override /datamodule: semcity/semcity
  - override /module: supervised
  - override /module/network: unet
  #- override /module/network@module.network2: efficientnet
  - override /module/scheduler: poly
  - override /trainer: gpu

name: semcity/test_sup

# all parameters below will be merged with parameters from default configurations set above
# this allows you to overwrite only specified parameters

seed: 1
ckpt: "/work/AI4GEO/users/fournip/outputs/semcity/run_sup/2023-10-01_171911/checkpoints/epoch_last.ckpt"

datamodule:
    #unsup: 0
    num_workers: 16
    #city: ARCACHON
    batch_size: 8
    #city: TOULOUSE
    sup: 80
    unsup: 0

paths:
    data: /work/AI4GEO/users/fournip
    #data: ${oc.env:TMPDIR}
    
module:
    ce_loss:
        ignore_index: 0
    dice_loss:
        ignore_index: 0
    scheduler:
        total_iters: 1200
            
trainer:
  max_time: "00:12:00:40"
  max_epochs: 1000
  limit_train_batches: 5
  limit_val_batches: 5

#paths:
#    output_dir: /data/outputs_archive
    
hydra:
  run:
    dir: ${paths.output_dir}/${name}/${now:%Y-%m-%d_%H%M%S}
  sweep:
    dir: ${paths.output_dir}/${name}/${now:%Y-%m-%d_%H%M%S}   
    #subdir: ${datamodule.sup}/${now:%Y-%m-%d_%H%M%S}
  launcher:
    timeout_min: 10
    
callbacks:
  model_checkpoint:
    dirpath: ${hydra:run.dir}/checkpoints