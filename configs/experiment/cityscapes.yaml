# @package _global_

defaults:
  - override /datamodule: cityscapes/cityscapes
  - override /module: supervised
  - override /scheduler@module.scheduler: poly
  - override /network@module.network: smp_deeplabv3p
  - override /transforms@module.norm: imagenet_norm
  - override /transforms@module.sliding: sliding_windows_cityscapes
  - override /loss@module.loss: ce

# all parameters below will be merged with parameters from default configurations set above
# this allows you to overwrite only specified parameters

datamodule:
    num_workers: 10
    steps_per_epoch: 370
    batch_size_s: 8

module:
    loss:
        ignore_index: 0
    optimizer:
        lr: 0.04
    network:
        encoder_name: resnet50
        encoder_weights: imagenet
    metric_ignore_index: 0


callbacks:
    model_avg:
        swa_epoch_start: 1000 #above max_epochs
    model_checkpoint:
        dirpath: ${hydra:sweep.dir}/${hydra:sweep.subdir}/checkpoints
    feature_ft:
        do_finetune: true
        unfreeze_at_epoch: 150

name: "cityscapes"
            
trainer:
  max_epochs: 300
  limit_train_batches: 1.
  limit_val_batches: 1.
    
hydra:
  sweeper:
    params:
      seed: 1
  sweep:
    dir: ${paths.output_dir}/${name}/${now:%Y-%m-%d_%H%M%S}  